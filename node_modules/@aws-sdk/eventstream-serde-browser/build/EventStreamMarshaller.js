import { EventStreamMarshaller as EventMarshaller } from "@aws-sdk/eventstream-marshaller";
import { ReadableStreamtoIterable } from "./utils";
import { getChunkedStream } from "./getChunkedStream";
import { getEventMessageStream } from "./getEventMessageStream";
import { getDeserializingStream } from "./getDeserializingStream";
var EventStreamMarshaller = /** @class */ (function () {
    function EventStreamMarshaller(_a) {
        var utf8Encoder = _a.utf8Encoder, utf8Decoder = _a.utf8Decoder;
        this.eventMarshaller = new EventMarshaller(utf8Encoder, utf8Decoder);
    }
    EventStreamMarshaller.prototype.deserialize = function (body, deserializer) {
        var chunkedStream = getChunkedStream(body);
        var messageStream = getEventMessageStream(chunkedStream, this.eventMarshaller);
        var deserialingStream = getDeserializingStream(messageStream, deserializer);
        return ReadableStreamtoIterable(deserialingStream);
    };
    /**
     * Generate a ReadableStream that serialize events
     * to event stream binary chunks; Use a pull stream
     * here to support low connection speed.
     *
     * This doesn't work on browser currently because
     * browser doesn't support upload streaming.
     * reference:
     * * https://bugs.chromium.org/p/chromium/issues/detail?id=688906
     * * https://bugzilla.mozilla.org/show_bug.cgi?id=1387483
     *
     */
    EventStreamMarshaller.prototype.serialize = function (input, serializer) {
        throw new Error("event stream request in browser is not supported\nReference: https://bugs.chromium.org/p/chromium/issues/detail?id=688906");
    };
    return EventStreamMarshaller;
}());
export { EventStreamMarshaller };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXZlbnRTdHJlYW1NYXJzaGFsbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL0V2ZW50U3RyZWFtTWFyc2hhbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUscUJBQXFCLElBQUksZUFBZSxFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFPM0YsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBQ25ELE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBU2xFO0lBRUUsK0JBQVksRUFBMEQ7WUFBeEQsNEJBQVcsRUFBRSw0QkFBVztRQUNwQyxJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksZUFBZSxDQUFDLFdBQVcsRUFBRSxXQUFXLENBQUMsQ0FBQztJQUN2RSxDQUFDO0lBRUQsMkNBQVcsR0FBWCxVQUNFLElBQW9CLEVBQ3BCLFlBQXdEO1FBRXhELElBQU0sYUFBYSxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdDLElBQU0sYUFBYSxHQUFHLHFCQUFxQixDQUN6QyxhQUFhLEVBQ2IsSUFBSSxDQUFDLGVBQWUsQ0FDckIsQ0FBQztRQUNGLElBQU0saUJBQWlCLEdBQUcsc0JBQXNCLENBQzlDLGFBQWEsRUFDYixZQUFZLENBQ2IsQ0FBQztRQUNGLE9BQU8sd0JBQXdCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNyRCxDQUFDO0lBRUQ7Ozs7Ozs7Ozs7O09BV0c7SUFDSCx5Q0FBUyxHQUFULFVBQ0UsS0FBdUIsRUFDdkIsVUFBaUM7UUFFakMsTUFBTSxJQUFJLEtBQUssQ0FBQywySEFDb0QsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7SUFDSCw0QkFBQztBQUFELENBQUMsQUF6Q0QsSUF5Q0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudFN0cmVhbU1hcnNoYWxsZXIgYXMgRXZlbnRNYXJzaGFsbGVyIH0gZnJvbSBcIkBhd3Mtc2RrL2V2ZW50c3RyZWFtLW1hcnNoYWxsZXJcIjtcbmltcG9ydCB7XG4gIEVuY29kZXIsXG4gIERlY29kZXIsXG4gIE1lc3NhZ2UsXG4gIEV2ZW50U3RyZWFtTWFyc2hhbGxlciBhcyBJRXZlbnRTdHJlYW1NYXJzaGFsbGVyXG59IGZyb20gXCJAYXdzLXNkay90eXBlc1wiO1xuaW1wb3J0IHsgUmVhZGFibGVTdHJlYW10b0l0ZXJhYmxlIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB7IGdldENodW5rZWRTdHJlYW0gfSBmcm9tIFwiLi9nZXRDaHVua2VkU3RyZWFtXCI7XG5pbXBvcnQgeyBnZXRFdmVudE1lc3NhZ2VTdHJlYW0gfSBmcm9tIFwiLi9nZXRFdmVudE1lc3NhZ2VTdHJlYW1cIjtcbmltcG9ydCB7IGdldERlc2VyaWFsaXppbmdTdHJlYW0gfSBmcm9tIFwiLi9nZXREZXNlcmlhbGl6aW5nU3RyZWFtXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRTdHJlYW1NYXJzaGFsbGVyIGV4dGVuZHMgSUV2ZW50U3RyZWFtTWFyc2hhbGxlciB7fVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2ZW50U3RyZWFtTWFyc2hhbGxlck9wdGlvbnMge1xuICB1dGY4RW5jb2RlcjogRW5jb2RlcjtcbiAgdXRmOERlY29kZXI6IERlY29kZXI7XG59XG5cbmV4cG9ydCBjbGFzcyBFdmVudFN0cmVhbU1hcnNoYWxsZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IGV2ZW50TWFyc2hhbGxlcjogRXZlbnRNYXJzaGFsbGVyO1xuICBjb25zdHJ1Y3Rvcih7IHV0ZjhFbmNvZGVyLCB1dGY4RGVjb2RlciB9OiBFdmVudFN0cmVhbU1hcnNoYWxsZXJPcHRpb25zKSB7XG4gICAgdGhpcy5ldmVudE1hcnNoYWxsZXIgPSBuZXcgRXZlbnRNYXJzaGFsbGVyKHV0ZjhFbmNvZGVyLCB1dGY4RGVjb2Rlcik7XG4gIH1cblxuICBkZXNlcmlhbGl6ZTxUPihcbiAgICBib2R5OiBSZWFkYWJsZVN0cmVhbSxcbiAgICBkZXNlcmlhbGl6ZXI6IChpbnB1dDogeyBbZXZlbnQ6IHN0cmluZ106IE1lc3NhZ2UgfSkgPT4gVFxuICApOiBBc3luY0l0ZXJhYmxlPFQ+IHtcbiAgICBjb25zdCBjaHVua2VkU3RyZWFtID0gZ2V0Q2h1bmtlZFN0cmVhbShib2R5KTtcbiAgICBjb25zdCBtZXNzYWdlU3RyZWFtID0gZ2V0RXZlbnRNZXNzYWdlU3RyZWFtKFxuICAgICAgY2h1bmtlZFN0cmVhbSxcbiAgICAgIHRoaXMuZXZlbnRNYXJzaGFsbGVyXG4gICAgKTtcbiAgICBjb25zdCBkZXNlcmlhbGluZ1N0cmVhbSA9IGdldERlc2VyaWFsaXppbmdTdHJlYW0oXG4gICAgICBtZXNzYWdlU3RyZWFtLFxuICAgICAgZGVzZXJpYWxpemVyXG4gICAgKTtcbiAgICByZXR1cm4gUmVhZGFibGVTdHJlYW10b0l0ZXJhYmxlKGRlc2VyaWFsaW5nU3RyZWFtKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIFJlYWRhYmxlU3RyZWFtIHRoYXQgc2VyaWFsaXplIGV2ZW50c1xuICAgKiB0byBldmVudCBzdHJlYW0gYmluYXJ5IGNodW5rczsgVXNlIGEgcHVsbCBzdHJlYW1cbiAgICogaGVyZSB0byBzdXBwb3J0IGxvdyBjb25uZWN0aW9uIHNwZWVkLlxuICAgKlxuICAgKiBUaGlzIGRvZXNuJ3Qgd29yayBvbiBicm93c2VyIGN1cnJlbnRseSBiZWNhdXNlXG4gICAqIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHVwbG9hZCBzdHJlYW1pbmcuXG4gICAqIHJlZmVyZW5jZTpcbiAgICogKiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD02ODg5MDZcbiAgICogKiBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD0xMzg3NDgzXG4gICAqXG4gICAqL1xuICBzZXJpYWxpemU8VD4oXG4gICAgaW5wdXQ6IEFzeW5jSXRlcmFibGU8VD4sXG4gICAgc2VyaWFsaXplcjogKGV2ZW50OiBUKSA9PiBNZXNzYWdlXG4gICk6IFJlYWRhYmxlU3RyZWFtIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYGV2ZW50IHN0cmVhbSByZXF1ZXN0IGluIGJyb3dzZXIgaXMgbm90IHN1cHBvcnRlZFxuUmVmZXJlbmNlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD02ODg5MDZgKTtcbiAgfVxufVxuIl19