import { __awaiter, __generator } from "tslib";
export function getDeserializingStream(messageStream, deserializer) {
    var messageReader = messageStream.getReader();
    var deserializedStream = new ReadableStream({
        start: function (controller) {
            function push() {
                var _this = this;
                messageReader.read().then(function (_a) {
                    var done = _a.done, value = _a.value;
                    return __awaiter(_this, void 0, void 0, function () {
                        var _b, _c, e_1;
                        return __generator(this, function (_d) {
                            switch (_d.label) {
                                case 0:
                                    if (done) {
                                        controller.close();
                                        return [2 /*return*/];
                                    }
                                    _d.label = 1;
                                case 1:
                                    _d.trys.push([1, 3, , 4]);
                                    _c = (_b = controller).enqueue;
                                    return [4 /*yield*/, deserializer(value)];
                                case 2:
                                    _c.apply(_b, [_d.sent()]);
                                    push();
                                    return [3 /*break*/, 4];
                                case 3:
                                    e_1 = _d.sent();
                                    controller.error(e_1);
                                    return [3 /*break*/, 4];
                                case 4: return [2 /*return*/];
                            }
                        });
                    });
                });
            }
            push();
        }
    });
    return deserializedStream;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0RGVzZXJpYWxpemluZ1N0cmVhbS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9nZXREZXNlcmlhbGl6aW5nU3RyZWFtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFFQSxNQUFNLFVBQVUsc0JBQXNCLENBQ3BDLGFBQTBELEVBQzFELFlBQWlDO0lBRWpDLElBQU0sYUFBYSxHQUFHLGFBQWEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNoRCxJQUFNLGtCQUFrQixHQUFHLElBQUksY0FBYyxDQUEwQjtRQUNyRSxLQUFLLFlBQUMsVUFBVTtZQUNkLFNBQVMsSUFBSTtnQkFBYixpQkFjQztnQkFiQyxhQUFhLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQU8sRUFBZTt3QkFBYixjQUFJLEVBQUUsZ0JBQUs7Ozs7OztvQ0FDNUMsSUFBSSxJQUFJLEVBQUU7d0NBQ1IsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO3dDQUNuQixzQkFBTztxQ0FDUjs7OztvQ0FHQyxLQUFBLENBQUEsS0FBQSxVQUFVLENBQUEsQ0FBQyxPQUFPLENBQUE7b0NBQUMscUJBQU0sWUFBWSxDQUFDLEtBQUssQ0FBQyxFQUFBOztvQ0FBNUMsY0FBbUIsU0FBeUIsRUFBQyxDQUFDO29DQUM5QyxJQUFJLEVBQUUsQ0FBQzs7OztvQ0FFUCxVQUFVLENBQUMsS0FBSyxDQUFDLEdBQUMsQ0FBQyxDQUFDOzs7Ozs7aUJBRXZCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxJQUFJLEVBQUUsQ0FBQztRQUNULENBQUM7S0FDRixDQUFDLENBQUM7SUFDSCxPQUFPLGtCQUFrQixDQUFDO0FBQzVCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNZXNzYWdlIH0gZnJvbSBcIkBhd3Mtc2RrL3R5cGVzXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZXNlcmlhbGl6aW5nU3RyZWFtKFxuICBtZXNzYWdlU3RyZWFtOiBSZWFkYWJsZVN0cmVhbTx7IFtuYW1lOiBzdHJpbmddOiBNZXNzYWdlIH0+LFxuICBkZXNlcmlhbGl6ZXI6IChpbnB1dDogYW55KSA9PiBhbnlcbik6IFJlYWRhYmxlU3RyZWFtPHsgW25hbWU6IHN0cmluZ106IGFueSB9PiB7XG4gIGNvbnN0IG1lc3NhZ2VSZWFkZXIgPSBtZXNzYWdlU3RyZWFtLmdldFJlYWRlcigpO1xuICBjb25zdCBkZXNlcmlhbGl6ZWRTdHJlYW0gPSBuZXcgUmVhZGFibGVTdHJlYW08eyBbbmFtZTogc3RyaW5nXTogYW55IH0+KHtcbiAgICBzdGFydChjb250cm9sbGVyKSB7XG4gICAgICBmdW5jdGlvbiBwdXNoKCkge1xuICAgICAgICBtZXNzYWdlUmVhZGVyLnJlYWQoKS50aGVuKGFzeW5jICh7IGRvbmUsIHZhbHVlIH0pID0+IHtcbiAgICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgICAgY29udHJvbGxlci5jbG9zZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb250cm9sbGVyLmVucXVldWUoYXdhaXQgZGVzZXJpYWxpemVyKHZhbHVlKSk7XG4gICAgICAgICAgICBwdXNoKCk7XG4gICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgY29udHJvbGxlci5lcnJvcihlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBwdXNoKCk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIGRlc2VyaWFsaXplZFN0cmVhbTtcbn1cbiJdfQ==